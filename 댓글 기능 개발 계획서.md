# 댓글 기능 개발 계획서

## 📋 개요

투표 페이지(VoteView.tsx)에 댓글 BottomModal 기능을 구현합니다.
사용자는 투표 후 댓글을 작성하고, 인기순/최신순으로 정렬된 댓글 목록을 무한스크롤로 확인할 수 있습니다.

## 🎯 주요 기능

### 1. 댓글 모달 UI
- 높이 고정된 BottomSheet 형태의 모달
- 상단: 제목("댓글 N개"), 인기순/최신순 탭, 닫기 버튼
- 중간: 댓글 목록 (스크롤 가능)
- 하단: 댓글 작성 폼 (닉네임, 비밀번호, 댓글 입력)

### 2. 댓글 목록
- 20개씩 무한스크롤 방식으로 로드
- 인기순(좋아요순) / 최신순 정렬
- 각 댓글: 닉네임, 내용, 좋아요 수, 작성/수정 시간, 수정/삭제 버튼

### 3. 댓글 작성
- 닉네임, 비밀번호, 댓글 내용 입력 필수
- 유효성 검증 및 에러 처리
- 작성 완료 후 목록 갱신

### 4. 댓글 수정
- 수정 버튼 클릭 → 비밀번호 확인 팝업 (BottomSheet 위에 겹침)
- 올바른 비밀번호 입력 → 수정 팝업 표시 (이전 내용 미리 채워짐)
- 수정: 내용만 변경 가능 (닉네임 불가)
- **삭제 기능**: 우선 보류 (TODO 예정)

### 5. 좋아요 기능
- 세션 기반 좋아요 (TKUID 관리)
- 좋아요/취소 토글 방식
- 좋아요 수 실시간 반영

## 📁 프로젝트 구조 분석

### 기존 파일
```
src/
├── components/
│   ├── common/
│   │   ├── Modal/Modal.tsx              # 공통 모달 컴포넌트
│   │   └── ModalInput/ModalInput.tsx    # 모달 인풋 컴포넌트
│   └── features/
│       └── Vote/
│           ├── VoteView.tsx              # 투표 페이지 (메인)
│           ├── ActionButtons/            # 댓글/링크복사 버튼
│           │   └── ActionButtons.tsx     # TODO 주석 있음
│           └── NicknameInputModal.tsx    # 닉네임 입력 모달 (참고용)
├── contexts/
│   └── ModalContext.tsx                  # 모달 컨텍스트
├── hooks/
│   └── api/
│       └── useComment.ts                 # 댓글 관련 훅 (이미 구현됨)
├── services/
│   └── api/
│       ├── comment.ts                    # 댓글 API (이미 구현됨)
│       └── display.ts                    # 전시 API (댓글 조회 포함)
├── types/
│   └── comment.ts                        # 댓글 타입 정의 (이미 구현됨)
└── lib/
    └── utils.ts                          # getRelativeTime 등 유틸리티
```

### 새로 생성할 파일
```
src/
└── components/
    └── features/
        └── Vote/
            └── CommentModal/
                ├── CommentModal.tsx              # 댓글 모달 메인 (BottomSheet)
                ├── CommentModal.module.scss      # 모달 스타일
                ├── CommentList.tsx               # 댓글 목록
                ├── CommentItem.tsx               # 댓글 아이템
                ├── CommentForm.tsx               # 댓글 작성 폼
                ├── CommentEditModal.tsx          # 댓글 수정 모달 (BottomSheet 위에 겹침)
                ├── CommentPasswordModal.tsx      # 비밀번호 확인 모달 (BottomSheet 위에 겹침)
                └── index.ts                      # Export
```

## 🔧 기술 스택 및 기존 구현 확인

### 이미 구현된 사항 ✅
1. **API 레이어** (src/services/api/comment.ts)
   - ✅ `commentApi.createComment` - 댓글 작성
   - ✅ `commentApi.updateComment` - 댓글 수정
   - ✅ `commentApi.verifyComment` - 비밀번호 검증
   - ✅ `commentApi.likeComment` - 좋아요
   - ✅ `commentApi.unlikeComment` - 좋아요 취소

2. **Display API** (src/services/api/display.ts)
   - ✅ `displayApi.getComments` - 댓글 목록 조회
     - sort: 'latest' | 'popular' (최신순/인기순)
     - cursor: 무한스크롤용 커서
     - size: 페이지 크기 (20개)
     - tkuId: 좋아요 상태 확인용

3. **React Query Hooks** (src/hooks/api/useComment.ts)
   - ✅ `useCreateComment` - 댓글 작성 mutation
   - ✅ `useUpdateComment` - 댓글 수정 mutation
   - ✅ `useVerifyComment` - 비밀번호 검증 mutation
   - ✅ `useLikeComment` - 좋아요 mutation
   - ✅ `useUnlikeComment` - 좋아요 취소 mutation

4. **타입 정의** (src/types/comment.ts)
   - ✅ `CommentItem` - 댓글 아이템
   - ✅ `CommentListResponse` - 댓글 목록 응답 (totalSize, nextId, comments)
   - ✅ `CreateCommentRequest` - 댓글 작성 요청
   - ✅ 기타 모든 타입 정의 완료

5. **유틸리티 함수** (src/lib/utils.ts)
   - ✅ `getRelativeTime` - 상대 시간 표시 ("방금 전", "5분전", "3시간전" 등)
   - ✅ `validateNickname` - 닉네임 검증 (10글자 제한, 영한숫 공백 -_. 허용)
   - ✅ `isValidNicknameCharacters` - 실시간 문자 검증

6. **모달 시스템** (src/contexts/ModalContext.tsx)
   - ✅ `showModal` - 커스텀 모달 표시
   - ✅ `showToast` - 토스트 메시지
   - ✅ `showConfirm` - 확인/취소 다이얼로그
   - ✅ `showAlert` - 알림 다이얼로그

### 새로 구현할 사항 🔨

1. **TKUID 관리 유틸리티**
   - SessionStorage에서 TKUID 관리
   - 없으면 새로 생성 (UUID v4)

2. **댓글 목록 조회 Hook**
   - `useInfiniteQuery`로 무한스크롤 구현
   - 인기순/최신순 탭 전환

3. **UI 컴포넌트들**
   - CommentModal (BottomSheet 형태)
   - CommentList (무한스크롤)
   - CommentItem (각 댓글)
   - CommentForm (작성 폼)
   - CommentEditModal (수정 모달)
   - CommentPasswordModal (비밀번호 확인)

## 📝 상세 구현 계획

### Phase 1: TKUID 관리 및 기본 구조

#### 1.1 TKUID 유틸리티 생성
**파일**: `src/lib/tkuid.ts`

```typescript
// TKUID (Trend-Kkultube Unique ID)를 세션스토리지에서 관리
// 세션 단위로 사용자를 식별하여 좋아요 중복 방지
```

**기능**:
- `getTKUID()`: 세션스토리지에서 TKUID 가져오기, 없으면 생성
- UUID v4 형식 사용

#### 1.2 댓글 개수 조회 Hook 생성
**파일**: `src/hooks/api/useComment.ts` (기존 파일 수정)

**추가 내용**:
- `useCommentCount` - 댓글 개수 조회 Query
- 필요시 `displayApi`에 댓글 개수 조회 API 추가

**Note**: 현재 `CommentListResponse`의 `totalSize`를 활용할 수 있음

#### 1.3 댓글 목록 무한스크롤 Hook
**파일**: `src/hooks/api/useCommentList.ts` (신규)

```typescript
// useInfiniteQuery를 사용한 무한스크롤 구현
// - sort: 'latest' | 'popular'
// - 20개씩 로드
// - cursor 기반 페이지네이션
```

**기능**:
- `useInfiniteCommentList(trendId, itemId, sort)` - 무한스크롤 댓글 목록
- `displayApi.getComments` 활용
- `hasNextPage`, `fetchNextPage` 제공

### Phase 2: CommentModal 기본 UI

#### 2.1 CommentModal 컴포넌트
**파일**: `src/components/features/Vote/CommentModal/CommentModal.tsx`

**Props**:
```typescript
interface CommentModalProps {
  isOpen: boolean;
  onClose: () => void;
  trendId: number;
  itemId: string;
  trendAlias: string;
}
```

**구조**:
```
┌─────────────────────────────┐
│  댓글 3개         [인기순 최신순] [X] │
├─────────────────────────────┤
│                             │
│  (CommentList - 스크롤 영역)  │
│                             │
├─────────────────────────────┤
│  (CommentForm - 고정 하단)   │
│  닉네임     │  비밀번호      │
│  댓글 200자 이내        [게시] │
└─────────────────────────────┘
```

**특징**:
- Portal을 사용하여 body 바로 아래 렌더링
- 높이 고정 (예: 70vh)
- 모달 외부 클릭 시 닫기
- ESC 키 닫기
- 스크롤 잠금
- ⭐ **라우터 변경 감지**: 뒤로가기 또는 라우터 이동 시 모든 모달 자동 닫기

#### 2.2 라우터 동기화 구현
**위치**: `CommentModal` 컴포넌트 내부

**구현 방법**:
```typescript
// Next.js의 usePathname 훅 사용
import { usePathname } from 'next/navigation';

// CommentModal 컴포넌트 내부
const pathname = usePathname();

useEffect(() => {
  // 라우터가 변경되면 모달 닫기
  onClose();
}, [pathname, onClose]);
```

**동작**:
1. 사용자가 브라우저 뒤로가기 버튼 클릭
2. 또는 다른 페이지로 이동 (Link 클릭 등)
3. `pathname`이 변경됨
4. `useEffect`가 실행되어 `onClose()` 호출
5. CommentModal, CommentPasswordModal, CommentEditModal 모두 닫힘

**장점**:
- 모달이 여러 개 중첩되어 있어도 한번에 모두 닫힘
- 브라우저 히스토리와 동기화
- 사용자가 뒤로가기로 빠져나갈 수 있음

#### 2.3 CommentModal 스타일
**파일**: `src/components/features/Vote/CommentModal/CommentModal.module.scss`

**주요 스타일**:
- BottomSheet 애니메이션 (아래에서 올라오는 효과)
- 헤더 고정 (제목, 탭, 닫기 버튼)
- 댓글 목록 스크롤 영역
- 하단 폼 고정

### Phase 3: 댓글 목록 UI

#### 3.1 CommentList 컴포넌트
**파일**: `src/components/features/Vote/CommentModal/CommentList.tsx`

**Props**:
```typescript
interface CommentListProps {
  trendId: number;
  itemId: string;
  sort: 'latest' | 'popular';
  onEditRequest: (comment: CommentItem) => void;
  // onDeleteRequest: (commentId: string) => void;  // TODO: 삭제 기능 보류
}
```

**기능**:
- `useInfiniteCommentList` 훅 사용
- Intersection Observer로 무한스크롤
- 로딩 상태, 에러 상태 처리
- 빈 목록 처리

#### 3.2 CommentItem 컴포넌트
**파일**: `src/components/features/Vote/CommentModal/CommentItem.tsx`

**Props**:
```typescript
interface CommentItemProps {
  comment: CommentItem;
  onLikeClick: (commentId: string, liked: boolean) => void;
  onEditClick: (comment: CommentItem) => void;
  // onDeleteClick: (commentId: string) => void;  // TODO: 삭제 기능 보류
}
```

**UI 구조**:
```
┌─────────────────────────────┐
│ 주관리  12시간 전              │
│ 영화 보고 카페 가면 안되나요?    │
│ 👍 445  [수정]                │  <- 삭제 버튼은 보류
└─────────────────────────────┘
```

**기능**:
- `getRelativeTime` 사용하여 시간 표시
- 좋아요 버튼 클릭 시 애니메이션
- 수정 버튼 (오른쪽 정렬)
- ~~삭제 버튼~~ (보류)

### Phase 4: 댓글 작성 폼

#### 4.1 CommentForm 컴포넌트
**파일**: `src/components/features/Vote/CommentModal/CommentForm.tsx`

**Props**:
```typescript
interface CommentFormProps {
  trendId: number;
  itemId: string;
  onSuccess: () => void;
}
```

**UI 구조**:
```
┌─────────────────────────────┐
│ [닉네임 입력]  │  [비밀번호]   │
├─────────────────────────────┤
│ [댓글 200자 이내............] │
│                       [게시] │
└─────────────────────────────┘
```

**유효성 검증**:
1. **닉네임**
   - `validateNickname` 사용
   - 최대 10글자
   - 영어, 한글, 숫자, 공백, -_. 허용
   - Trim 처리

2. **비밀번호**
   - 4~15자리
   - Focus 이벤트 시 빨간 테두리 제거
   - 4자리 미만 시 토스트 알림

3. **댓글 내용**
   - 최대 200자
   - 빈 값 불가

**에러 처리**:
- 입력 안된 필드: 빨간 테두리
- Focus 시: 테두리 제거
- 비밀번호 4자리 미만: 토스트 메시지

**기능**:
- `useCreateComment` 훅 사용
- 작성 완료 후 폼 초기화
- 성공 토스트 메시지

### Phase 5: 댓글 수정 기능

#### 5.1 CommentPasswordModal 컴포넌트
**파일**: `src/components/features/Vote/CommentModal/CommentPasswordModal.tsx`

**UI 구조** (첨부된 이미지 기반):
```
┌─────────────────────────────┐
│  비밀번호 입력             [X] │
├─────────────────────────────┤
│  [비밀번호를 입력하세요]       │
│                             │
│  잘못된 비밀번호입니다.        │  <- 에러 메시지 (빨간색)
│                             │
│              [확인]          │  <- 파란색 버튼
└─────────────────────────────┘
```

**Props**:
```typescript
interface CommentPasswordModalProps {
  isOpen: boolean;
  onClose: () => void;
  commentId: string;
  onVerified: (editToken: string) => void;
}
```

**중요 사항**:
- ⭐ **BottomSheet 위에 겹쳐서 표시됨** (z-index 높게 설정)
- Portal을 사용하여 렌더링
- 중앙 정렬 모달 (BottomSheet와 다른 스타일)
- 반투명 배경 (dimmed)

**기능**:
1. 비밀번호 입력 필드
   - Placeholder: "비밀번호를 입력하세요"
   - Type: password
   - 4-15자리 검증

2. `useVerifyComment` 훅 사용
   - 검증 성공 시: `editToken` 반환 → `onVerified` 콜백 호출
   - 검증 실패 시: "잘못된 비밀번호입니다." 에러 메시지 표시 (빨간색)

3. 확인 버튼
   - 비밀번호 입력 시 활성화
   - 파란색 버튼

4. 닫기 (X) 버튼
   - 우측 상단

#### 5.2 CommentEditModal 컴포넌트
**파일**: `src/components/features/Vote/CommentModal/CommentEditModal.tsx`

**UI 구조** (첨부된 이미지 기반):
```
┌─────────────────────────────┐
│  댓글 수정                 [X] │
├─────────────────────────────┤
│  ┌─────────────────────────┐ │
│  │ 댓글 200자 이내         │ │  <- Textarea
│  │ (이전 댓글 내용 미리 채워짐) │ │
│  │                         │ │
│  └─────────────────────────┘ │
│                             │
│              [수정]          │  <- 파란색 버튼
└─────────────────────────────┘
```

**Props**:
```typescript
interface CommentEditModalProps {
  isOpen: boolean;
  onClose: () => void;
  comment: CommentItem;
  editToken: string;
}
```

**중요 사항**:
- ⭐ **BottomSheet 위에 겹쳐서 표시됨** (z-index 높게 설정)
- Portal을 사용하여 렌더링
- 중앙 정렬 모달
- 반투명 배경 (dimmed)

**기능**:
1. 댓글 내용 수정
   - **이전 댓글 내용이 미리 채워져 있음** (`comment.content`)
   - 최대 200자
   - 닉네임은 수정 불가 (표시만)

2. `useUpdateComment` 훅 사용
   - `editToken` 포함하여 API 호출
   - 수정 완료 후 목록 갱신

3. 수정 버튼
   - 내용이 변경되었을 때만 활성화
   - 파란색 버튼

4. 닫기 (X) 버튼
   - 우측 상단

#### 5.3 수정 플로우 정리

```
사용자: [수정] 버튼 클릭
  ↓
CommentPasswordModal 표시 (BottomSheet 위에 겹침)
  ↓
비밀번호 입력 → [확인] 클릭
  ↓
useVerifyComment API 호출
  ↓
성공: editToken 받음
  ↓
CommentPasswordModal 닫기
  ↓
CommentEditModal 표시 (BottomSheet 위에 겹침, 이전 내용 미리 채워짐)
  ↓
댓글 수정 → [수정] 클릭
  ↓
useUpdateComment API 호출 (editToken 포함)
  ↓
성공: 목록 갱신, 모달 닫기
```

#### 5.4 삭제 기능 (보류)

**⚠️ 삭제 기능은 현재 우선 보류합니다 (TODO 예정)**

- 삭제 버튼은 UI에 표시하되, 클릭 시 "준비 중입니다" 토스트 표시
- 또는 삭제 버튼 자체를 숨김 처리
- 향후 개선 사항에 추가

### Phase 6: 좋아요 기능

#### 6.1 좋아요 핸들러
**위치**: `CommentItem` 컴포넌트 내부

**기능**:
- `getTKUID()` 호출하여 TKUID 가져오기
- 현재 좋아요 상태에 따라 `useLikeComment` 또는 `useUnlikeComment` 호출
- Optimistic Update 적용 (즉시 UI 반영, 실패 시 롤백)
- 애니메이션 효과

#### 6.2 좋아요 상태 관리
- `CommentItem`의 `liked` 필드 활용
- API 응답의 `likeCount` 실시간 반영

### Phase 7: ActionButtons 연동

#### 7.1 ActionButtons 수정
**파일**: `src/components/features/Vote/ActionButtons/ActionButtons.tsx`

**수정 사항**:
1. 댓글 개수 동적으로 가져오기
   - 하드코딩된 `commentCount = 101` 제거
   - `useCommentCount` 훅 사용 (또는 API 호출)

2. `handleCommentClick` 구현
   - 투표 완료 후에만 활성화 (`commentDisabled` prop)
   - `showModal`로 `<CommentModal>` 표시
   - `trendId`, `itemId`, `trendAlias` prop 전달 필요

#### 7.2 VoteView 수정
**파일**: `src/components/features/Vote/VoteView.tsx`

**수정 사항**:
1. ActionButtons에 필요한 props 전달
   - `trendId={trendData.trendId}`
   - `itemId={item.id}` (현재 아이템)
   - `trendAlias={trendData.alias}`

2. 현재 아이템 정보 ActionButtons에 전달하는 방법 고민
   - 각 VoteCard마다 ActionButtons가 있음
   - 현재 선택된 아이템에 대한 댓글만 표시

## 🎨 UI/UX 스펙 상세

### 1. 색상 및 스타일
- **빨간 테두리**: 에러 상태 (입력 안됨)
- **포커스**: 빨간 테두리 제거, 기본 포커스 스타일
- **좋아요 버튼**: 누르면 색상 변경 (예: 회색 → 파란색)
- **비활성 버튼**: 회색 처리

### 2. 애니메이션
- **모달 열기**: 아래에서 위로 슬라이드 (0.3s ease-out)
- **모달 닫기**: 위에서 아래로 슬라이드 (0.2s ease-in)
- **좋아요 클릭**: 하트 아이콘 bounce 효과

### 3. 반응형
- 모바일 퍼스트 디자인
- 모달 너비: 최대 480px
- 모달 높이: 70vh (고정)

### 4. 접근성
- 모든 버튼에 `aria-label` 추가
- 키보드 네비게이션 지원
- 포커스 관리 (모달 열릴 때 첫 입력 필드로 포커스)

## 🧪 테스트 계획

### 1. 단위 테스트
- TKUID 유틸리티 함수
- 유효성 검증 함수
- 각 컴포넌트 렌더링

### 2. 통합 테스트
- 댓글 작성 플로우
- 댓글 수정 플로우 (비밀번호 확인 → 수정 모달)
- 좋아요 플로우
- 무한스크롤
- 모달 레이어링 (BottomSheet + 비밀번호/수정 모달)

### 3. E2E 테스트
- 투표 → 댓글 작성 → 목록 확인
- 댓글 수정 (비밀번호 확인 → 수정)
- 탭 전환 (인기순/최신순)
- 모달 중첩 상황 테스트
- **라우터 동기화 테스트**:
  - 모달 열린 상태에서 브라우저 뒤로가기 → 모달 닫힘 확인
  - 여러 모달 중첩 상태에서 뒤로가기 → 모든 모달 한번에 닫힘 확인
  - 모달 열린 상태에서 다른 페이지 이동 → 모달 닫힘 확인

## 📌 주의사항

### 1. 모달 레이어링 및 라우터 동기화 (중요 ⭐)

#### 모달 z-index 레이어링
- **CommentModal**: BottomSheet 형태, z-index: 1000
- **CommentPasswordModal**: BottomSheet 위에 겹침, z-index: 1100
- **CommentEditModal**: BottomSheet 위에 겹침, z-index: 1100
- Portal을 사용하여 body 직접 렌더링
- 각 모달의 dimmed 배경 투명도 조절 필요

#### 라우터 변경 시 모달 자동 닫기 ⭐
**문제**: 사용자가 모달을 열어둔 상태에서 브라우저 뒤로가기를 누르거나 다른 페이지로 이동하면 모달이 남아있음

**해결책**:
```typescript
// CommentModal.tsx
import { usePathname } from 'next/navigation';

const CommentModal = ({ isOpen, onClose, ... }) => {
  const pathname = usePathname();

  // 라우터 변경 감지하여 모달 닫기
  useEffect(() => {
    if (isOpen) {
      onClose();
    }
  }, [pathname]);

  // ... 나머지 코드
};
```

**동작 시나리오**:
1. 사용자: 댓글 모달 열기 → CommentModal 열림
2. 사용자: 수정 버튼 클릭 → CommentPasswordModal 열림 (CommentModal 위에 겹침)
3. 사용자: 비밀번호 확인 → CommentEditModal 열림 (CommentModal 위에 겹침)
4. 사용자: 브라우저 뒤로가기 클릭 ⚡
5. 시스템: `pathname` 변경 감지 → 모든 모달 닫기 (`onClose()`)
6. 결과: CommentModal, CommentPasswordModal, CommentEditModal 모두 한번에 닫힘

**장점**:
- 모달이 여러 개 중첩되어 있어도 한번에 처리
- 브라우저 히스토리와 자연스럽게 동기화
- 사용자가 뒤로가기로 모달 빠져나갈 수 있음
- 다른 페이지로 이동 시에도 자동으로 정리됨

### 2. 삭제 기능 보류
- ⚠️ **삭제 기능은 현재 보류됨 (TODO 예정)**
- 삭제 버튼은 UI에서 제거하거나 비활성화
- 향후 개선 사항에 포함

### 3. 타입 추가 필요
- `src/types/comment.ts`에 누락된 타입 확인
  - 댓글 개수 조회 응답 타입 (필요시)

### 4. 비밀번호 유효성
- 현재 스펙: "4~15자리"
- 서버 검증 규칙 확인 필요 (특수문자, 영문/숫자 필수 등)

### 5. TKUID 생명주기
- 세션스토리지: 탭 닫으면 사라짐
- 같은 탭에서는 유지됨
- 새로고침 시 유지됨

### 6. 수정 시간 표시
- `CommentItem`의 `updatedAt` 필드 존재 여부 확인
- 없으면 타입 추가 필요

### 7. 댓글 개수 실시간 업데이트
- 댓글 작성/삭제 시 ActionButtons의 댓글 개수 갱신
- React Query의 `invalidateQueries` 활용

## 🚀 구현 순서

### Step 1: 기초 작업 (1-2시간)
1. TKUID 유틸리티 생성
2. 댓글 목록 무한스크롤 Hook 생성

### Step 2: CommentModal 기본 구조 (2-3시간)
1. CommentModal 컴포넌트 생성
2. 라우터 변경 감지 로직 구현 (usePathname + useEffect)
3. 스타일 작성 (BottomSheet)
4. 열기/닫기 애니메이션

### Step 3: 댓글 목록 (2-3시간)
1. CommentList 컴포넌트
2. CommentItem 컴포넌트
3. 무한스크롤 구현
4. 탭 전환 (인기순/최신순)

### Step 4: 댓글 작성 (2-3시간)
1. CommentForm 컴포넌트
2. 유효성 검증
3. 에러 처리
4. API 연동

### Step 5: 수정 기능 (2-3시간)
1. CommentPasswordModal 생성
   - BottomSheet 위에 겹치는 중앙 모달
   - 비밀번호 입력 및 검증
   - 에러 메시지 표시
2. CommentEditModal 생성
   - BottomSheet 위에 겹치는 중앙 모달
   - 이전 댓글 내용 미리 채움
   - 수정 API 연동
3. 수정 플로우 통합 테스트
4. ⚠️ 삭제 기능은 보류 (삭제 버튼 제거 또는 비활성화)

### Step 6: 좋아요 기능 (1-2시간)
1. 좋아요 핸들러 구현
2. TKUID 연동
3. Optimistic Update
4. 애니메이션

### Step 7: ActionButtons 연동 (1-2시간)
1. ActionButtons 수정
2. VoteView 수정
3. 댓글 개수 동적 로드

### Step 8: 테스트 및 버그 수정 (2-3시간)
1. 각 기능 테스트
2. 엣지 케이스 확인
3. UI/UX 개선

**총 예상 시간: 12-20시간** (삭제 기능 보류로 시간 단축)

## 📚 참고 자료

### 기존 코드 참고
1. **NicknameInputModal.tsx**: 모달 구조, 입력 검증 참고
2. **PollCard.tsx**: `getRelativeTime` 사용 예시
3. **ModalContext.tsx**: 모달 시스템 사용법

### API 문서
- `src/services/api/comment.ts`: 댓글 API 전체 구조
- `src/services/api/display.ts`: 댓글 목록 조회 API
- `src/types/comment.ts`: 댓글 타입 정의

### Hooks 참고
- `src/hooks/api/useComment.ts`: 댓글 관련 React Query 훅

## ✅ 체크리스트

### 개발 시작 전
- [ ] 서버 API 엔드포인트 확인
- [ ] 타입 정의 확인 (누락된 필드 체크)
- [ ] 디자인 시안 최종 확인
- [ ] 모달 z-index 레이어링 전략 수립
- [ ] 라우터 동기화 전략 수립 (usePathname 사용)

### 개발 중
- [ ] TKUID 관리 구현
- [ ] 무한스크롤 구현
- [ ] 댓글 작성 구현
- [ ] **라우터 변경 감지 및 모달 자동 닫기 구현** ⭐
- [ ] 비밀번호 확인 모달 구현 (BottomSheet 위에 겹침)
- [ ] 댓글 수정 모달 구현 (이전 내용 미리 채움)
- [ ] 수정 플로우 통합 (비밀번호 → 수정)
- [ ] 좋아요 구현
- [ ] ActionButtons 연동
- [ ] ⚠️ 삭제 버튼 제거 또는 비활성화

### 개발 완료 후
- [ ] 모든 기능 테스트
- [ ] 반응형 확인
- [ ] 접근성 확인
- [ ] **라우터 동기화 테스트** (뒤로가기, 페이지 이동 시 모달 닫힘 확인)
- [ ] 성능 최적화 (React.memo, useMemo 등)
- [ ] 코드 리뷰 준비

## 🔮 향후 개선 사항

1. **댓글 삭제 기능**: 현재 보류된 삭제 기능 구현 (최우선)
2. **대댓글 기능**: 현재는 1depth만 지원
3. **신고 기능**: 부적절한 댓글 신고
4. **이미지 첨부**: 댓글에 이미지 첨부
5. **실시간 업데이트**: WebSocket으로 실시간 댓글 갱신
6. **검색 기능**: 댓글 내용 검색
7. **필터링**: 내가 쓴 댓글만 보기

---

**작성일**: 2025-12-15
**작성자**: Claude Code AI Agent
**버전**: 1.2 (수정: 라우터 동기화 전략 추가 - 뒤로가기 시 모달 자동 닫기)
